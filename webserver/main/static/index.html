<html>
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonform/2.2.5/jsonform.js" crossorigin="anonymous"></script>
    <title>ai-camera</title>
  </head>
  <body>
    <div class="container-fluid">
       <div class="row"><h2>ai-camera sandbox</h2></div>
        <div class="row" id="topUiRow" style="height:70%">
          <div class="col-4">
            <ul class="nav nav-tabs" id="configTab" role="tablist">
            <li class="nav-item active" role="presentation">
                <button class="nav-link" id="sensor-tab" data-bs-toggle="tab" data-bs-target="#sensor" type="sensor" role="tab" aria-controls="sensor" aria-selected="true">Image Sensor</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="system-tab" data-bs-toggle="tab" data-bs-target="#system" type="button" role="tab" aria-controls="system" aria-selected="false">System</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="cnn-tab" data-bs-toggle="tab" data-bs-target="#cnn" type="cnn" role="tab" aria-controls="cnn" aria-selected="false">CNN</button>
            </li>
            </ul>
            <div class="tab-content" id="configTabContent">
              <div class="tab-pane fade show active" id="sensor" role="tabpanel" aria-labelledby="sensor-tab">
                <form class="form-inline row g-3" style="overflow-y:scroll" id="imageSensorConfigForm">
                </form>
              </div>
              <div class="tab-pane fade overflow-auto" id="system" role="tabpanel" aria-labelledby="system-tab">
                <form id="systemConfigForm">
                </form>
                </div>
                <div class="tab-pane fade overflow-auto" id="cnn" role="tabpanel" aria-labelledby="cnn-tab">
                  TODO
                </div>
            </div>
          </div>
          <div class="col">
            <div class="row">
                <img id="viewport" height="600px" src="/image.jpg"
                    onerror="this.onerror=null, this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII='">
            </div>
            <div class="row gap-5" style="margin: 5px">
              <button type="button" id="playStream" class="col btn btn-outline-success">Run stream <span class="bi bi-file-play-fill"></button>
              <button type="button" id="stopStream" class="col btn btn-outline-danger">Stop stream <span class="bi bi-pause-btn-fill"></button>
              <button type="button" id="getJPEG" class="col btn btn-outline-primary">JPEG <span class="bi bi-download"></button>
              <button type="button" id="getYUV422" class="col btn btn-outline-primary">YUV422 <span class="bi bi-download"></button>
              <button type="button" id="getRGB565" class="col btn btn-outline-primary">RGB565 <span class="bi bi-download"></button>
            </div>
          </div>
        </div>
        <div class="row">
          <h4>Stats</h4>
          <div class="row">
            <dt class="col">CPU0, %</dt><dl class="col" id="cpu0Val">10</dl>
            <dt class="col">CPU1, %</dt><dl class="col" id="cpu1Val">1</dl>
            <dt class="col">DRAM, kB</dt><dl class="col" id="dramVal">157</dl>
            <dt class="col">PSRAM, kB</dt><dl class="col" id="psramVal">7512</dl>
          </div>
          <div class="row">
            <dt class="col">Chip temp, C</dt><dl class="col" id="tempVal">25</dl>
            <dt class="col">FPS</dt><dl class="col" id="fpsVal">n/a</dl>
            <dt class="col">Light, lux</dt><dl class="col" id="lightVal">100</dl>
            <dt class="col">Motion</dt><dl class="col" id="motionVal">0</dl>
          </div>
          <div class="row">
            <dt class="col">IR state</dt><dl class="col" id="irStateVal">Day</dl>
            <dt class="col">Battery, mV</dt><dl class="col" id="vbatVal">3851</dl>
            <dt class="col"></dt><dl class="col"></dl>
            <dt class="col"></dt><dl class="col"></dl>
          </div>
        </div>
    </div>
    <script type="text/javascript">
        $('#imageSensorConfigForm').css('height', $('#topUiRow').outerHeight() - 30)
        $('#imageSensorConfigForm').jsonForm({
        schema: {
            resolution: {
                type: 'string',
                title: 'Resolution',
                required: true,
                enum: [
                    "160", "320", "640", "800", "1600"
                ]
            },
            contrast: {
                type: 'integer',
                title: 'Contrast',
                required: true,
                minimum: -2,
                maximum: 2
            },
            brightness: {
                type: 'integer',
                title: 'Brigtness',
                required: true,
                minimum: -2,
                maximum: 2
            },
            saturation: {
                type: 'integer',
                title: 'Saturation',
                required: true,
                minimum: -2,
                maximum: 2
            },
            sharpness: {
                type: 'integer',
                title: 'Sharpness',
                required: true,
                minimum: -2,
                maximum: 2
            },
            denoise: {
                type: 'boolean',
                title: 'Denoise',
                required: true
            },
            gainceiling: {
                type: 'integer',
                title: 'Gainceiling',
                required: true,
                minimum: 0,
                maximum: 6
            },
            jpeg_quality: {
                type: 'integer',
                title: 'JPEG quality',
                required: true,
                minimum: 0,
                maximum: 64
            },
            colorbar: {
                type: 'boolean',
                title: 'Colorbar',
                required: true
            },
            whitebal: {
                type: 'boolean',
                title: 'Enable AWB',
                required: true
            },
            gain_ctrl: {
                type: 'boolean',
                title: 'Enable AGC',
                required: true
            },
            exposure_ctrl: {
                type: 'boolean',
                title: 'Enable AEC',
                required: true
            },
            hmirror: {
                type: 'boolean',
                title: 'Enable horizontal mirroring',
                required: true
            },
            vflip: {
                type: 'boolean',
                title: 'Enable vertical flip',
                required: true
            },
            aec2: {
                type: 'boolean',
                title: 'Enable AEC2',
                required: true
            },
            awb_gain: {
                type: 'integer',
                title: 'AWB Gain',
                required: true,
                minimum: 0,
                maximum: 255
            },
            agc_gain: {
                type: 'integer',
                title: 'AGC Gain',
                required: true,
                minimum: 0,
                maximum: 255
            },
            aec: {
                type: 'integer',
                title: 'AEC value',
                required: true,
                minimum: 0,
                maximum: 1200
            },
            special_effect: {
                type: 'integer',
                title: 'Special effect',
                required: true,
                minimum: 0,
                maximum: 6
            },
            wb_mode: {
                type: 'integer',
                title: 'White Balance mode',
                required: true,
                minimum: 0,
                maximum: 4
            },
            ae_level: {
                type: 'integer',
                title: 'AE level',
                required: true,
                minimum: -2,
                maximum: 2
            },
            dcw: {
                type: 'boolean',
                title: 'DCW',
                required: true
            },
            bpc: {
                type: 'boolean',
                title: 'BPC',
                required: true
            },
            wpc: {
                type: 'boolean',
                title: 'WPC',
                required: true
            },
            raw_gma: {
                type: 'boolean',
                title: 'Raw GMA',
                required: true
            },
            lenc: {
                type: 'boolean',
                title: 'Lenc',
                required: true
            },
            xclk_freq: {
                type: 'integer',
                title: 'XCLK frequency',
                required: true,
                enum: [ 1e6, 2e6, 4e6, 8e6, 16e6, 10e6, 20e6 ]
            },
            ir_mode: {
                type: 'integer',
                title: 'IR mode',
                enum: [ 0, 1 ]
            },
            ir_light_thresh_high: {
                type: 'integer',
                title: 'IR light thresh high',
                minimum: 0,
                maximum: 16000
            },
            ir_light_thresh_low: {
                type: 'integer',
                title: 'IR light thresh low',
                minimum: 0,
                maximum: 16000
            },
            ir_brightness: {
                type: 'integer',
                title: 'IR LEDs brightness',
                minimum: 0,
                maximum: 255
            },
        },
        onSubmit: function (errors, values) {
            if (errors) {
            $('#res').html('<p>I beg your pardon?</p>');
            } else {
            $('#res').html('<p>Hello ' + values.name + '.' +
                (values.age ? '<br/>You are ' + values.age + '.' : '') +
                '</p>');
            }
        }
        });
    </script>
  </body>
</html>
